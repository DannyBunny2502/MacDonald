<!DOCTYPE html>
<html lang="ko"xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>

<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>


<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<!--  jQuery UI CSS파일  -->
<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" />  
<!-- jQuery 기본 js파일 --> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>  
<!-- jQuery UI 라이브러리 js파일 --> 
<script src="http://code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>  

<meta charset="utf-8">
<title>Insert title here</title>
<style>
#formAll {
	margin: 30px;
}

.form-control {
	width: 100%;
	margin: 0px;
}

#buttonGrp {
	float: right;
	margin-right: 350px;
}

#searchBtn {
	float: right;
	margin-right: 350px;
}

#mtrTable {
	margin: 20px;
	width: 80%;
}
/* The Modal (background) */
.modal {
	display: none; /* Hidden by default */
	position: fixed; /* Stay in place */
	z-index: 1; /* Sit on top */
	left: 0;
	top: 0;
	width: 100%; /* Full width */
	height: 300%; /* Full height */
	overflow: auto; /* Enable scroll if needed */
	background-color: rgb(0, 0, 0); /* Fallback color */
	background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
	background-color: #fefefe;
	margin: 15% auto; /* 15% from the top and centered */
	padding: 20px;
	border: 1px solid #888;
	width: 50%; /* Could be more or less, depending on screen size */
}
/* The Close Button */
.close {
	color: #aaa;
	float: right;
	font-size: 28px;
	font-weight: bold;
}

.close:hover, .close:focus {
	color: black;
	text-decoration: none;
	cursor: pointer;
}
#buttonModalGrp{
	float: right;
}
</style>


</head>
<body>

	<div id="formAll" class="container-fluid" style="margin-top:30px;">
		<form class="form-inline">
			<div class="form-group" style="margin-right:20px;">
				<label for="files">원료명</label>
			    <select name="cars" id="contentsMtrNm" class="form-control">
			      <option value="N">선택없음</option>
			      <optgroup label="원료">
			        <option th:each="material : ${materialList}" th:value="${material.mtrCode}" th:text="${material.mtrName}"></option>
			      </optgroup>
			      <optgroup label="완제품">
			        <option th:each="menu : ${menuList}" th:value="${menu.menuCode}" th:text="${menu.menuName}"></option>
			      </optgroup>
			    </select>
			</div>
			<div class="form-group">
				<label for="exampleInputEmail2">입고시간  </label> 
				<input type="text" id="yymmdd" class="form-control" placeholder="입고 년월일 입력">
			</div>
			<div class="form-group">
				<select name="cars" id="hhmi" class="form-control">
			      	<option value="0">전체</option>
			        <option value="1">00:00 ~ 02:59</option>
			        <option value="2">03:00 ~ 05:59</option>
			        <option value="3">06:00 ~ 08:59</option>
			        <option value="4">09:00 ~ 11:59</option>
			        <option value="5">12:00 ~ 14:59</option>
			        <option value="6">15:00 ~ 17:59</option>
			        <option value="7">18:00 ~ 20:59</option>
			        <option value="8">21:00 ~ 23:59</option>
			    </select>
			</div>
			<button type="button" class="btn btn-info" id="searchBtn">검색</button>
		
		<br><br>
		
			<div class="form-group" style="margin-right:20px;">
				<label for="exampleInputName2">담당자  </label> <input type="text"
					class="form-control" id="rgstUserName" placeholder="담당자명 입력">
			</div>
		
				
			</div>
			<div class="form-group" id="buttonGrp">
				<div class="btn-group">
					<button type="button" class="btn btn-danger" id="addBtn">추가</button>
					<button type="button" class="btn btn-success" id="modifyBtn">수정</button>
					<button type="button" class="btn btn-default" id="cancelBtn">취소</button>
				</div>
			</div>
		


	</div>
	</form>
	<br>

	<div class="form-row">
		<div class="form-group">
			<div id="mtrGrid">
				<table id="mtrTable"
					class="table table-striped table-bordered table-hover">
					<thead>
		    <tr>
		      <th scope="col" style="text-align: center;">no</th>
		      <th scope="col" style="text-align: center;">입출구분</th>
		      <th scope="col" style="text-align: center;">입출일시</th>
		      <th scope="col" style="text-align: center;">원료코드</th>
		      <th scope="col" style="text-align: center;">원료명</th>
		      <th scope="col" style="text-align: center;">수량</th>
		      <th scope="col" style="text-align: center;">입출내용</th>
		      <th scope="col" style="text-align: center;">등록일시</th>
		      <th scope="col" style="text-align: center;">등록자</th>
		    </tr>
		  </thead>
		  <tbody>
		    <tr th:if="${not #lists.isEmpty(matstoreList)}" th:each="matstore, index : ${matstoreList}" style="text-align: center;"
		    	id="tableTr">
		       <td th:text="${index.index}+1"></td>  
		       <td th:text="${matstore.strGubunCode}"></td>  
		       <td th:text="${matstore.strTime}"></td>
		       <td th:text="${matstore.mtrCode}"></td>
		       <td th:text="${matstore.mtrName}"></td>
		       <td th:text="${matstore.strQnt} +' 개'"></td>
		       <td th:text="${matstore.strDist}"></td>
		       <td th:text="${matstore.rgstDt}"></td>
		       <td th:text="${matstore.rgstUser}"></td>
		       <td style="display:none;" th:text="${matstore.strCode}"></td>
		     </tr>
		     <tr th:unless="${not #lists.isEmpty(matstoreList)}">
		       <td colspan="7">조회된 결과가 없습니다.</td>
		     </tr>
		  </tbody>
					
				</table>
			</div>
		</div>
	</div>


	<!-- Add Modal Content -->
	<div id="myModal" class="modal" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-lg">
		<div class="modal-content" style="width:640px; min-height:300px; padding:20px;">
			<span class="close">&times;</span>
			<div class="container-fluid">
				<form class="form-inline" id="modalForm">
					<div class="form-group" style="margin-right:20px;">
						<label for="files">원료명</label>
					    <select name="cars" class="form-control" id="materialName">
					      <option value="N">선택없음</option>
					      <optgroup label="원료">
					        <option th:each="material : ${materialList}" th:value="${material.mtrCode}" th:text="${material.mtrName}"></option>
					      </optgroup>
					      <optgroup label="완제품">
					        <option th:each="menu : ${menuList}" th:value="${menu.menuCode}" th:text="${menu.menuName}"></option>
					      </optgroup>
					    </select>
					</div>
					<div class="form-group">
						<label for="exampleInputEmail2">입출구분</label> 
						<select id="ioDivision" name="cars" class="form-control">
						  <option value="I" selected>입고</option>
						  <option value="O">출고</option>
						</select>
					</div>
				</form>
				<br>
				<form class="form-inline">
					<div class="form-group">
						<label for="exampleInputName2">입출고 근거</label> 
						<input type="text"
							class="form-control" id="ioContents"
							placeholder="Jane Doe">
					</div>
					<div class="form-group">
						<label for="exampleInputEmail2">입출고 수량</label> <input type="text"
							class="form-control" id="ioQtt"
							placeholder="3">
					</div>
					<br><br>
					<div class="form-group" id="buttonModalGrp">
						<div class="btn-group">
							<button type="button" class="btn btn-danger" id="saveBtn">저장</button>
							<button type="button" class="btn btn-default" id="cancelModalBtn">취소</button>
						</div>
					</div>
				</form>


			</div>
		</div>
		</div>
	</div>
	
	<!-- Get the modal -->

	<script>
		var modal = document.getElementById('myModal');
		var modifyModal = document.getElementById('modifyModal');
		
		var addBtn = document.getElementById("addBtn");
		var modifyBtn = document.getElementById("modifyBtn");
		var materialName = document.getElementById("materialName");
		var saveBtn = document.getElementById("saveBtn");
		var cancelBtn = document.getElementById("cancelBtn");
		var searchBtn = document.getElementById("searchBtn");
		
		var span = document.getElementsByClassName("close")[0];
	
		var mtrNameVal = $("#materialName option:selected").val();
		var strGubumCodeVal = $("#ioDivision option:selected").val();
		var strDistVal = $("#ioContents").val();
		var strQntVal = $("#ioQtt").val();
		
		var clkStrCd;
		
		
		addBtn.onclick = function() {
			modal.style.display = "block";
			$("#materialName option:eq(0)").prop("selected", true);
			$("#ioQtt").val('');
			$("#ioContents").val('');
			$("#ioDivision option:eq(0)").prop("selected", true);
		}
		// 수정 기능.
		modifyBtn.onclick = function() {
			modal.style.display = "block";
			$("#materialName option:eq(0)").prop("selected", true);
			$("#ioQtt").val('');
			$("#ioContents").val('');
			$("#ioDivision option:eq(0)").prop("selected", true);
			
			saveBtn.onclick = function(){
				strQntVal = $("#ioQtt").val();
				$.ajax({
			        type:"POST",
			        url:"/updateMatstore",
			        data : {mtrName: $("#materialName option:selected").val(),
			        		strGubunCode: strGubumCodeVal,
			        		strDist: strDistVal,
			        		strQnt: strQntVal,
			        		strCode: clkStrCd},
			        dataType : "json",
			        success: function(data){
			        	if(data==1){
			        		alert("정상적으로 처리되었습니다.");
			        		span.onclick()=function(){}
			        	}else{
			        		alert("데이터가 저장되지 않았습니다.");
			        	}
			            
			        },
			        error: function(xhr, status, error) {
			            alert("에러발생");
			        }  
			    });
			}
		
			// 그 행의 strCd 정상적으로 갖고옴.
			console.log("수정창의 기본키: "+clkStrCd);
		}

		span.onclick = function() {
			modal.style.display = "none";
			location.reload();
		}

		window.onclick = function(event) {
			if (event.target == modal) {
				modal.style.display = "none";
			}
		}
		<!-- Table Click Event -->
		$("#mtrTable tr").click(function(){     
	 
	        var str = ""
	        var tdArr = new Array();    // 배열 선언
	            
	        // 현재 클릭된 Row(<tr>)
	        var tr = $(this);
	        var td = tr.children();
	        
	        console.log("클릭한 Row의 모든 데이터 : "+tr.text());

	        // 반복문을 이용해서 배열에 값을 담아 사용할 수 도 있다.
	        td.each(function(i){
	            tdArr.push(td.eq(i).text());
	        });
			
	        // 가져온 값 변수에 담기
	        clkStrCd = td.eq(9).text();
	        console.log("기본키: "+clkStrCd);
		 });
		
		// 원료 추가   저장 버튼
		saveBtn.onclick = function(){
			var mtrNameVal = mtrNameVal;
			var strGubumCodeVal = $("#ioDivision option:selected").val();
			var strDistVal = $("#ioContents").val();
			var strQntVal = $("#ioQtt").val();
			console.log("mtrNameVal: "+mtrNameVal);
			$.ajax({
		        type:"POST",
		        url:"/saveMatstore",
		        data : {mtrName: $("#materialName option:selected").val(),
		        		strGubunCode: strGubumCodeVal,
		        		strDist: strDistVal,
		        		strQnt: strQntVal},
		        dataType : "json",
		        success: function(data){
		        	if(data==1){
		        		alert("정상적으로 처리되었습니다.");
		        		span.onclick()=function(){}
		        	}else{
		        		alert("데이터가 저장되지 않았습니다.");
		        	}
		            
		        },
		        error: function(xhr, status, error) {
		            alert("에러발생");
		        }  
		    });
		}
		
	// datepicker
	$( "#yymmdd" ).datepicker({
		dateFormat: "yy-mm-dd",
		showMonthAfterYear: true
	});
	
	// 조건에 Select
	searchBtn.onclick = function(){
		var inputFromTime;
		var inputToTime;
		var inputDateVal = $("#yymmdd").val();
		var inputDate = inputDateVal.replace(/-/g,"");
		var timeCode = $("#hhmi option:selected").val();
		alert(timeCode)
		if(timeCode = '0'){
			inputFromTime = '000000';
			inputToTime = '235959';
		}else if(timeCode = '1'){
			inputFromTime = '000000';
			inputToTime = '025959';
		}else if(timeCode = '2'){
			inputFromTime = '030000';
			inputToTime = '055959';
		}else if(timeCode = '3'){
			inputFromTime = '060000';
			inputToTime = '085959';
		}else if(timeCode = '4'){
			inputFromTime = '090000';
			inputToTime = '115959';
		}else if(timeCode = '5'){
			inputFromTime = '120000';
			inputToTime = '145959';
		}else if(timeCode = '6'){
			inputFromTime = '150000';
			inputToTime = '175959';
		}else if(timeCode = '7'){
			inputFromTime = '180000';
			inputToTime = '205959';
		}else{
			inputFromTime = '210000';
			inputToTime = '235959';
		}
		
		$.ajax({
	        type:"POST",
	        url:"/selectWhere",
	        data : {mtrName: $("#contentsMtrNm option:selected").val(),
	        		inputFromTime: inputDate + inputFromTime,
	        		inputToTime: inputDate + inputToTime,
	        		rgstUser: $("#rgstUserName").val()},
	        dataType : "json",
	        success: function(matstoreList){
	        	if(matstoreList){
       	            // Contents 영역 삭제
       	            //$('#mtrGrid').remove();
       	            // Contents 영역 교체
       	            //$('#mtrGrid').html(matstoreList);
	        		$.each(matstoreList, function(index, element) {
        				$("td:eq("+index+")").html(element.text);
	        		});
	        	}else{
	        		alert("검색 실패");
	        	}
	            
	        },
	        error: function(xhr, status, error) {
	            alert("에러발생");
	        }  
	    });
	}
	</script>
</body>
</html>